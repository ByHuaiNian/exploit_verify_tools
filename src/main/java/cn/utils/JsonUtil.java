package cn.utils;

import cn.model.CmsType;
import cn.model.ExpInfo;
import com.google.gson.JsonArray;
import com.google.gson.JsonObject;
import com.google.gson.JsonParser;

import java.io.File;
import java.util.ArrayList;
import java.util.List;

/**
 * JSON工具类
 */
public class JsonUtil {

    //JSON文件路径
    public static final String FILENAME = System.getProperty("user.dir")+ File.separator+"config"+File.separator+"exploit.json";

    //获取expJSON列表,返回实体集合
    public static List<ExpInfo> getExpJson(){
        List<ExpInfo> expInfoList = new ArrayList<ExpInfo>();
        try {
            //创建Json解析器
            JsonParser parser = new JsonParser();

            //解析对象
            JsonObject object = (JsonObject) parser.parse(new FileReader(FILENAME,"UTF-8"));
            //读取对象内容
            for (String s : object.keySet()) {
                CmsType cmsType = new CmsType();
                cmsType.setCmsName(s);
                JsonArray array = object.get(s).getAsJsonArray();
                for (int i = 0; i < array.size(); i++) {
                    ExpInfo expInfo = new ExpInfo();
                    JsonObject subObject = array.get(i).getAsJsonObject();
                    //设置expInfo值
                    expInfo.setId(subObject.get("id").getAsString());
                    expInfo.setName(subObject.get("name").getAsString());
                    expInfo.setType(subObject.get("type").getAsString());
                    expInfo.setTime(subObject.get("time").getAsString());
                    expInfo.setInfo(subObject.get("info").getAsString());
                    expInfo.setCmsType(cmsType);
                    expInfo.setClassName(subObject.get("classname").getAsString());
                    expInfoList.add(expInfo);
                }
            }

        } catch (Exception e) {
            e.printStackTrace();
        }finally {
            return expInfoList;
        }
    }

    //获取cmsJSON列表,返回实体集合
    public static List<CmsType> getCmsJson(){
        List<CmsType> cmsTypes = new ArrayList<CmsType>();
        try {
            //创建Json解析器
            JsonParser parser = new JsonParser();
            //解析对象
            JsonObject object = (JsonObject) parser.parse(new FileReader(FILENAME,"UTF-8"));
            //读取对象内容
            for (String s : object.keySet()) {
                CmsType cmsType = new CmsType();
                cmsType.setCmsName(s);
                cmsTypes.add(cmsType);
            }

        } catch (Exception e) {
            e.printStackTrace();
        }finally {
            return cmsTypes;
        }
    }


}
